#include <WiFi.h>
#include <PubSubClient.h>

const char* ssid = "YourWiFiSSID";
const char* password = "YourWiFiPassword";
const char* mqtt_server = "broker.hivemq.com";

// WiFi and MQTT clients
WiFiClient espClient;
PubSubClient client(espClient);

// Sensor reading functions
float readGlucoseSensor() {
    // Simulated glucose reading
    return random(90, 140);
}

void setup() {
    Serial.begin(115200);
    WiFi.begin(ssid, password);
    while (WiFi.status() != WL_CONNECTED) {
        delay(1000);
        Serial.println("Connecting to WiFi...");
    }
    client.setServer(mqtt_server, 1883);
    Serial.println("Connected to WiFi!");
}

void loop() {
    if (!client.connected()) {
        while (!client.connected()) {
            Serial.println("Connecting to MQTT...");
            if (client.connect("IoTDevice")) {
                Serial.println("Connected to MQTT!");
            } else {
                delay(5000);
            }
        }
    }
    float glucose = readGlucoseSensor();
    char glucose_str[8];
    dtostrf(glucose, 1, 2, glucose_str);
    client.publish("health/glucose", glucose_str);
    delay(5000);
}
